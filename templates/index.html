<!doctype html>
<html lang="en">

<head>
   <title>Mother V2</title>

   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Neucha&family=Open+Sans:ital,wght@0,400;0,600;0,800;1,400;1,700;1,800&display=swap"
      rel="stylesheet">

   <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
   <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap.min.css') }}">
</head>

<body>
   <script>
      document.addEventListener('DOMContentLoaded', async function () {
         // Get the pagination parameters from the query string or use default values
         const page = new URLSearchParams(window.location.search).get('page') || 1;
         const perPage = new URLSearchParams(window.location.search).get('per_page') || 50;

         // Fetch data from the server
         const response = await fetch(`/index?page=${page}&per_page=${perPage}`);

         if (response.ok) {
            // Parse the JSON data
            const data = await response.json();
            console.log(data);

            // Use the data as needed, for example, update the DOM
            // Example: Assuming there's a div with id="items-container" to display the items
            const itemsContainer = document.getElementById('items-container');
            itemsContainer.innerHTML = ''; // Clear previous content

            data.items.forEach(item => {
               const itemElement = document.createElement('div');
               itemElement.textContent = JSON.stringify(item);
               itemsContainer.appendChild(itemElement);
            });

            // You can also use other data like total_pages, current_page, etc., as needed
         } else {
            console.error('Failed to fetch data:', response.statusText);
         }
      });
   </script>

   <!-- Add this input element for file selection -->
   <input type="file" id="csv-file-input" accept=".csv" style="display:none;">


   <!-- Navigation -->
   <section>
      <div class="container-fluid">
         <div class="row mt-3">
            <nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top">
               <div class="container-fluid">
                  <a class="navbar-brand" href="#">Nexus one</a>
                  <button id="btnCollapse" class="navbar-toggler" type="button" data-toggle="collapse"
                     data-target="#navbarID" aria-controls="navbarID" aria-expanded="false"
                     aria-label="Toggle navigation">
                     <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse">
                     <div class="navbar-nav">
                        <div id="menu-container" class="d-flex flex-wrap">
                           <button class="m-2 btn btn-outline-light btnModal" id="add-product-button"
                              data-targetmodal="#Add_Product">Add Product</button>
                           <button class="m-2 btn btn-outline-light" id="delete-selected-button">Delete
                              Selected</button>
                           <button class="m-2 btn btn-outline-light" id="add-via-csv-button" onclick="handleCsvUpload()">Add via CSV</button>
                           <button class="m-2 btn btn-outline-light" id="parse-all-prices-button">Parse All
                              Prices</button>
                           <button class="m-2 btn btn-outline-light" id="parse-selected-prices-button">Parse Selected
                              Prices</button>
                           <button class="m-2 btn btn-outline-light" id="parse-all-delivery-prices-button">Parse All
                              Delivery
                              Prices</button>
                           <button class="m-2 btn btn-outline-light" id="parse-selected-delivery-prices-button">Parse
                              Selected
                              Delivery Prices</button>
                           <button class="m-2 btn btn-outline-light btnModal" data-targetmodal="#Customize"
                              id="customize-button">Customize</button>
                        </div>
                     </div>
                  </div>
               </div>
            </nav>
         </div>
      </div>
   </section>

      <!-- Add an edit form or modal to your HTML -->
   <div class="modal fade" id="edit-modal" tabindex="-1" aria-labelledby="edit-modal-label" aria-hidden="true">
      <div class="modal-dialog">
         <div class="modal-content">
            <div class="modal-header">
                  <h5 class="modal-title" id="edit-modal-label">Edit Product</h5>
                  <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                  <form id="edit-form">
                     <input type="text" class="form-control" id="edit-sku" placeholder="SKU" required>
                     <input type="text" class="form-control" id="edit-name" placeholder="Name" required>
                     <input type="text" class="form-control" id="edit-thr-link" placeholder="THR Link">
                     <!-- Add more fields as needed -->
                     <button type="submit" class="btn btn-primary">Save Changes</button>
                  </form>
            </div>
         </div>
      </div>
   </div>


   <!-- Modal Hidden modal dialog for column customization-->
   <section>
      <div id="customize-dialog" class="modalW modal fade  dNone" data-targetmodal="#Customize">
         <div class="bgModalEvent btnModal" data-targetmodal="#Customize"></div>
         <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
               <div class="modal-header">
                  <h1 class="modal-title fs-5">Customize Columns</h1>
                  <button type="button" class="btn-close btnModal" data-targetmodal="#Customize"></button>
               </div>
               <div class="modal-body d-flex justify-content-between flex-wrap align-items-center customize-checkboxes"
                  id="customize-checkboxes">
                  <!-- Checkboxes and names will be added dynamically using JavaScript -->
               </div>
               <div class="modal-body d-flex justify-content-between flex-wrap align-items-center">
                  <div>
                     <strong>Style Table:</strong>
                  </div>
                  <div id="CreateFormCheckingStyles" class="d-flex flex-wrap justify-content-between align-items-center">
                     <!-- Create Radio Style table -->
                  </div>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="customize-save">Save</button>
                  <button type="button" class="btn btn-secondary btnModal" data-targetmodal="#Customize"
                     id="customize-cancel">Cancel</button>

               </div>
            </div>
         </div>
      </div>

      <div class="modalW modal fade  dNone" data-targetmodal="#Add_Product">
         <div class="bgModalEvent btnModal" data-targetmodal="#Add_Product"></div>
         <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
               <div class="modal-header">
                  <h1 class="modal-title fs-5">Add Product</h1>
                  <button type="button" class="btn-close btnModal" data-targetmodal="#Add_Product"></button>
               </div>
               <div class="modal-body">
                  <form id="add-product-form">
                     <!-- Add input fields for product details -->
                     <input type="text" class="my-2 form-control" id="ASIN" placeholder="ASIN" required>
                     <input type="text" class="my-2 form-control" id="SKU" placeholder="SKU" required>
                     <input type="text" class="my-2 form-control" id="Name" placeholder="Name">
                     <input type="text" class="my-2 form-control" id="ThrLink" placeholder="Thr Link">
                     <input type="text" class="my-2 form-control" id="WSlink" placeholder="WS link">
                     <input type="text" class="my-2 form-control" id="PricingStrategy"
                        placeholder="Pricing Strategy">
                     <input type="text" class="my-2 form-control" id="BasicHndlingTime" placeholder="Basic Hndling Time">
                     <input type="text" class="my-2 form-control" id="Price"
                        placeholder="Price">
                     <input type="text" class="my-2 form-control" id="DeliveryPriceTHR10001" placeholder="Delivery Price THR 10001">
                     <input type="text" class="my-2 form-control" id="DeliveryPriceWS10001" placeholder="Delivery Price WS 10001">
                     <input type="text" class="my-2 form-control" id="DeliveryPriceTHR90001" placeholder="Delivery Price THR 90001">
                     <input type="text" class="my-2 form-control" id="DeliveryPriceWS90001" placeholder="Delivery Price WS 90001">
                     <input type="text" class="my-2 form-control" id="ThresholdForMedianHTCalculation" placeholder="Threshold For Median HT Calculation">
                     <input type="text" class="my-2 form-control" id="OrdersCount" placeholder="Orders Count">
                     <input type="text" class="my-2 form-control" id="UnitsSoldCount" placeholder="Units Sold Count">
                     <input type="text" class="my-2 form-control" id="ReturnsCount" placeholder="Returns Count">
                     <input type="text" class="my-2 form-control" id="AZCount" placeholder="AZ Count">
                     <input type="text" class="my-2 form-control" id="ItemNumber" placeholder="Item Number">
                     <input type="text" class="my-2 form-control" id="StockAviability" placeholder="Stock Aviability">
                     <input type="text" class="my-2 form-control" id="FreeShippingWithPlus" placeholder="Free Shipping With Plus">
                     <!-- Add more input fields for other product details -->
                     <div class="modal-footer">
                        <button type="submit" class="btn btn-success menu-container btnModal"
                           data-targetmodal="#Add_Product">Add</button>
                        <button type="button" class="btn btn-secondary btnModal"
                           data-targetmodal="#Add_Product">Close</button>
                     </div>
                  </form>
               </div>
            </div>
         </div>
      </div>
 
      <div class="modalW modal fade dNone" data-targetmodal="#columnindex">
         <div class="bgModalEvent btnModal" data-targetmodal="#columnindex"></div>
         <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
               <div class="modal-header">
                  <h1 class="modal-title fs-5 titleModalAddViacsv"></h1>
                  <button type="button" class="btn-close btnModal" data-targetmodal="#columnindex"></button>
               </div>
               <div class="modal-body ContentModalAddViacsv"> 
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-secondary btnModal" data-targetmodal="#columnindex">Close</button>
                  <button type="button" class="btn btn-primary POSTaddviascsv">Save changes</button>
               </div>
            </div>
         </div>
      </div>
   </section>





   <!-- Content  -->
   <section>
      <div class="container-fluid">
         <div class="row mt-10">
            <div class="col-12 d-flex flex-column my-2">
               <div class="d-flex my-2">

                  <div class="d-flex flex-column m-2">
                     <div>
                        <form class="form-inline">
                           <strong>Search</strong>
                           <div class="input-group mb-3">
                              <input id="InpSearch" type="text" class="form-control" placeholder="Text...">
                              <button class="btn btn-outline-secondary" type="button" id="SearchSubmit" disabled>Button</button>
                           </div>
                        </form>
                     </div>
                     <div class="d-flex">
                        <div class="form-check m-2">
                           <input class="form-check-input" type="radio" title="ASIN" name="SearchRadio" id="RadiASIN"
                              checked>
                           <label class="form-check-label" for="RadiASIN">
                              ASIN
                           </label>
                        </div>
                        <div class="form-check m-2">
                           <input class="form-check-input" type="radio" title="SKU" name="SearchRadio" id="RadioSKU">
                           <label class="form-check-label" for="RadioSKU">
                              SKU
                           </label>
                        </div>
                        <div class="form-check m-2">
                           <input class="form-check-input" type="radio" title="Pricing Strategy" name="SearchRadio"
                              id="RadioPricingStrategy">
                           <label class="form-check-label" for="RadioPricingStrategy">
                              Pricing Strategy
                           </label>
                        </div>
                     </div>
                  </div>

                  <div class="d-flex m-2">
                     <form class="form-inline">
                        <strong>Number of items</strong>
                        <div class="input-group mb-3">
                           <input id="InpNumberOfItems" value="10" type="number" class="form-control"
                              placeholder="Number of items">
                           <button class="btn btn-outline-secondary" type="button" id="BtnNumberOfItems">Button</button>
                        </div>
                     </form>
                  </div>

               </div>

 

            </div>

            <div class="col-12 my-2 overflow-x-scroll">
               <table class="ToggleStyleTable table-striped table table-bordered">
                  <!-- NewTableHeaders Create columns th -->
                  <thead>
                     <tr id="NewTableHeaders"></tr>
                  </thead>
                  <!-- newTable Create Rows td -->
                  <tbody id="newTable"></tbody>
               </table>
            </div>
         </div>
      </div>
   </section>

    

   <!-- Pagination -->
   <section>
      <div class="container-fluid">
         <div class="row mt-10">
            <div class="col-12 d-flex my-2">
               <nav class="fixedBot" aria-label="Page navigation example">
                  <div class="p-2 m-1 styletotalPgage text-bg-dark">
                     <span id="current-page">Page <b>{{ current_page }}</b> of <span id="total-pages">{{ total_pages
                           }}</span></span>
                  </div>

                  <ul class="pagination pagidark">
                     <li class="page-item"><a class="page-link" href="?page=1&per_page={{ per_page }}">First</a></li>
                     {% if current_page > 1 %}
                     <li class="page-item"><a class="page-link"
                           href="?page={{ current_page - 1 }}&per_page={{ per_page }}">Previous</a></li>
                     {% endif %}
                     {% if current_page < total_pages %} <li class="page-item"><a class="page-link"
                           href="?page={{ current_page + 1 }}&per_page={{ per_page }}">Next</a></li>
                        {% endif %}
                        <li class="page-item"><a class="page-link"
                              href="?page={{ total_pages }}&per_page={{ per_page }}">Last</a></li>
                  </ul>
               </nav>
            </div>
         </div>
      </div>
   </section>

   <script type="module" src="{{ url_for('static', filename='script.js') }}"></script>
</body>

<!-- Add this script block with JavaScript code -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function handleCsvUpload() {
        // Trigger the file input click
        $("#csv-file-input").click();
    }

    // Handle file selection and form submission
    $(document).ready(function () {
        $("#csv-file-input").change(function () {
            // Get the selected file
            var file = this.files[0];

            // Create a FormData object and append the file
            var formData = new FormData();
            formData.append("csv_file", file);

            // Use Ajax to submit the form
            $.ajax({
                type: "POST",
                url: "/upload_csv",
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    // Handle the response from the server
                    console.log(response);
                    // Optionally, you can display a message to the user
                    alert(response.message);
                },
                error: function (error) {
                    // Handle the error
                    console.error("Error uploading CSV file:", error);
                }
            });
        });
    });
</script>


<!-- <script>

<script>

   document.addEventListener('DOMContentLoaded', function () {
       // Add click event listener to each row
       const rows = document.querySelectorAll('#newTable tr');
       rows.forEach(row => {
           row.addEventListener('click', function () {
               // Get data from the clicked row and populate the edit form
               const rowData = JSON.parse(row.getAttribute('data-row'));
               populateEditForm(rowData);
           });
       });
   });

   function populateEditForm(data) {
       // Populate the edit form with data from the clicked row
       // Example: Assuming you have input fields with IDs like 'edit-sku', 'edit-name', etc.
       document.getElementById('edit-sku').value = data.SKU;
       document.getElementById('edit-name').value = data.Name;
       document.getElementById('edit-thr-link').value = data['THR Link'];
       // Add more fields as needed
       // Show the edit modal or form
       $('#edit-modal').modal('show');
   }

</script> -->
<!-- 
<script>
   $(document).ready(function () {
       // Add submit event listener to the edit form
       $('#edti-form').submit(function (event) {
=======
</script>

<script>
   $(document).ready(function () {
       // Add submit event listener to the edit form
       $('#edit-form').submit(function (event) {

           event.preventDefault();

           // Get data from the edit form
           const updatedData = {
               sku: $('#edit-sku').val(),
               name: $('#edit-name').val(),
               thrLink: $('#edit-thr-link').val(),
               // Add more fields as needed
           };

           // Use Ajax to submit the edit form
           $.ajax({
               type: 'POST',
               url: '/update_product',
               data: JSON.stringify(updatedData),
               contentType: 'application/json',
               success: function (response) {
                   // Handle the response from the server
                   console.log(response);
                   // Optionally, you can display a message to the user
                   alert(response.message);
                   // Hide the edit modal
                   $('#edit-modal').modal('hide');
               },
               error: function (error) {
                   // Handle the error
                   console.error('Error updating product:', error);
               }
           });
       });
   });

</script> -->

</script>



</html>